<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>使用 Github Actions 部署react-app 到 Github Pages</title><meta name="description" content="使用 Github Actions 部署react-app 到 Github Pages"/><link rel="icon" href="/CarStation.svg"/><meta name="google-site-verification" content="JPHZGs4Zk2iX0LKmv_kGBKtIfuo3rUJCO0AD6aP8bYc"/><meta name="next-head-count" content="6"/><link rel="preload" href="/_next/static/css/6e0c8d9ced1e22d0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e0c8d9ced1e22d0.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b24a9a06bb53618e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b24a9a06bb53618e.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-7180b5018c6594e2.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-a6a17768821d805e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-cc4289bbb2571876.js" defer=""></script><script src="/_next/static/chunks/647-2045c5df6fd5ed37.js" defer=""></script><script src="/_next/static/chunks/337-dc7edfac29e0cd58.js" defer=""></script><script src="/_next/static/chunks/pages/artcontent/%5Baid%5D-35eb7a1c749591f7.js" defer=""></script><script src="/_next/static/kRrtnNUirzJtMh_xDWC5r/_buildManifest.js" defer=""></script><script src="/_next/static/kRrtnNUirzJtMh_xDWC5r/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="rootPage"><div class="pageHeader" style="background-image:url(/_next/static/media/sea-bg.34630b96.jpg)"><div class="pageHeaderContent pageHeaderContent-detail">诗和远方</div></div><div class="layouts"><div class="layoutsmenu"><div class="layoutsmenufixed" style="height:0"><div class="players"><button type="button" class="ant-btn ant-btn-link layoutsButton"><span role="img" aria-label="home" class="anticon anticon-home"><svg viewBox="64 64 896 896" focusable="false" data-icon="home" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 00-44.4 0L77.5 505a63.9 63.9 0 00-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0018.7-45.3c0-17-6.7-33.1-18.8-45.2zM568 868H456V664h112v204zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3h-96.1z"></path></svg></span><span>主页</span></button><button type="button" class="ant-btn ant-btn-link layoutsButton"><span role="img" aria-label="snippets" class="anticon anticon-snippets"><svg viewBox="64 64 896 896" focusable="false" data-icon="snippets" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M832 112H724V72c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v40H500V72c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v40H320c-17.7 0-32 14.3-32 32v120h-96c-17.7 0-32 14.3-32 32v632c0 17.7 14.3 32 32 32h512c17.7 0 32-14.3 32-32v-96h96c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM664 888H232V336h218v174c0 22.1 17.9 40 40 40h174v338zm0-402H514V336h.2L664 485.8v.2zm128 274h-56V456L544 264H360v-80h68v32c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-32h152v32c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-32h68v576z"></path></svg></span><span>刷新页面</span></button><button type="button" class="ant-btn ant-btn-link layoutsButton"><span role="img" aria-label="github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0138.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></span><span>我的主页</span></button></div></div><div class="adminControl"><span class="adminControl-line1"></span><span class="adminControl-line2"><span class="adminControl-line4"></span></span><span class="adminControl-line3"></span></div></div><div class="layoutsMain"><div><main class="artcontent_main__Q2ogA"><h1>使用 Github Actions 部署react-app 到 Github Pages</h1><p>Loading ...</p><div class="artcontent_extra__RKNS4"><div>2022/11/23</div></div></main></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"datas":{"id":98,"art_title":"使用 Github Actions 部署react-app 到 Github Pages","art_content":"\u003ch2 style=\"text-align: start;\"\u003e原文： \u003ca href=\"https://segmentfault.com/a/1190000041449997\" target=\"_blank\"\u003ehttps://segmentfault.com/a/1190000041449997\u003c/a\u003e \u003c/h2\u003e\u003ch2 style=\"text-align: start;\"\u003e前言-学以致用\u003c/h2\u003e\u003cp style=\"text-align: start;\"\u003e之前一直忙于开发，总是零散的去看一些东西，想想学东西了么？额... 好像学了，又好像没有学，不知道你们有没有这种感觉，所以新年初始，换一种学习方法，本着学以致用去完整的学一些东西，正好之前想接触CI,CD 这里的知识，所以就从最常见的github开始吧，毕竟免费又常用。\u003c/p\u003e\u003ch2 style=\"text-align: start;\"\u003e初始化项目\u003c/h2\u003e\u003cp style=\"text-align: start;\"\u003e创建github代码仓库，clone 项目到本地，进入目录初始化项目\u003c/p\u003e\u003cpre style=\"text-align: start; line-height: 1.5;\"\u003e\u003ccode\u003enpx create-react-app\u003c/code\u003e\u003c/pre\u003e\u003cp style=\"text-align: start;\"\u003e然后按照命令提示输入完成初始化,推送项目到github。\u003c/p\u003e\u003ch2 style=\"text-align: start;\"\u003e配置github actions\u003c/h2\u003e\u003cp style=\"text-align: start;\"\u003e目标是实现推送代码到master分支, 自动开始构建项目，部署到Gthub Pages。\u003cbr\u003e按照\u003ca href=\"https://link.segmentfault.com/?enc=BsHuQ0PzigUZ28kaoAvQ1A%3D%3D.qxiSOELr%2FQtZg8yDLMw5z%2F3N%2Fg7890IdTr0xBDUgph6mtDx00VjRN6ObO29wJLlQ\" target=\"_blank\"\u003e文档\u003c/a\u003e先跑起来第一个流程，让自己看到效果，在去学习语法内容，这样更能激发兴趣，免得直接看文档看睡着了...\u003c/p\u003e\u003col style=\"text-align: start;\"\u003e\u003cli\u003e在目录外层增加 .gihub/workflows文件夹，创建第一个first-demo.yml文件，拷贝示例内容.\u003c/li\u003e\u003c/ol\u003e\u003cpre style=\"text-align: start; line-height: 1.5;\"\u003e\u003ccode\u003ename: GitHub Actions Demo\non: [push]\njobs:\n  Explore-GitHub-Actions:\n    runs-on: ubuntu-latest\n    steps:\n      - run: echo \"🎉 The job was automatically triggered by a ${{ github.event_name }} event.\"\n      - run: echo \"🐧 This job is now running on a ${{ runner.os }} server hosted by GitHub!\"\n      - run: echo \"🔎 The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}.\"\n      - name: Check out repository code\n        uses: actions/checkout@v2\n      - run: echo \"💡 The ${{ github.repository }} repository has been cloned to the runner.\"\n      - run: echo \"🖥️ The workflow is now ready to test your code on the runner.\"\n      - name: List files in the repository\n        run: |\n          ls ${{ github.workspace }}\n      - run: echo \"🍏 This job's status is ${{ job.status }}.\"\u003c/code\u003e\u003c/pre\u003e\u003col style=\"text-align: start;\"\u003e\u003cli\u003e提交代码，点击gihub仓库上方的\u003cstrong\u003eActions\u003c/strong\u003e按钮，查看效果，第一个工作流程就完成了。\u003cbr\u003e\u003cimg src=\"https://segmentfault.com/img/bVcX4QB\" alt=\"image.png\" data-href=\"\" style=\"\"\u003e\u003c/li\u003e\u003c/ol\u003e\u003ch2 style=\"text-align: start;\"\u003e开始编写自己的yml文件,实现自动构建\u003c/h2\u003e\u003cp style=\"text-align: start;\"\u003e快速过一遍文档，学习一下语法，实现自己想要的工作流程。从demo可以看到主要有流程有这么几步\u003c/p\u003e\u003col style=\"text-align: start;\"\u003e\u003cli\u003ename 工作流程的名称。 GitHub 在仓库的操作页面上显示工作流程的名称。\u003c/li\u003e\u003cli\u003eon 触发流程的事件，具体可以触发的事件有\u003ca href=\"https://link.segmentfault.com/?enc=RQOtsmXdu0%2FEXbROT%2FG%2F2Q%3D%3D.7z%2ByjH%2FOcAA%2Fn%2FAOG%2FPEc7sSAqWm8y9eeuk2jE6mKo3Sady7tvQdfp9twn8zABomtUFNy9UaxNnRKqmagziAA9KkvrPW%2FqZd9INMAa1hQb5%2Bbgd048QnZ4pxSaX8iVBA\" target=\"_blank\"\u003e这些\u003c/a\u003e,我们所要实现的是提交代码，所以用 push.\u003c/li\u003e\u003cli\u003ejobs 要按顺序运行作业.\u003c/li\u003e\u003c/ol\u003e\u003cp style=\"text-align: start;\"\u003e目标明确后，开始编写yml\u003c/p\u003e\u003cpre style=\"text-align: start; line-height: 1.5;\"\u003e\u003ccode class=\"language-xml\"\u003e # 显示得workflow名称\n name: First GitHub Actions Demo\n on: \n   # 推送到master分支开始打包\n   push:\n     branches:\n       - master\n\n jobs:\n   # 开始打包\n   Build:\n     runs-on: ubuntu-latest\n     steps:\n     - name: checkout code\n       # 迁出触发的流程的版本 能让下面的工作流程访问\n       uses: actions/checkout@v2\n       # setup-node 可以提供node环境，指定node版本以及 npm /yarn缓存\n     - name: actions/setup-node@v2\n       uses: actions/setup-node@v2   \n       with:\n         node: 16.14\n     # 初始用的npm 打包时间太长了，就想着用yarn 结果没仔细看文档，yarn 不用安装 ubuntu 上面有的 \n     # - name: install yarn \n     #  uses: npm install yarn     \n     # - run: yarn install\n     # - run: yarn build\n     # 简写为\n     - run: yarn install \u0026amp;\u0026amp; yarn build\u003c/code\u003e\u003c/pre\u003e\u003cp style=\"text-align: start;\"\u003e好了提交代码看Actions（这是上面没有优化时的流程）。\u003cbr\u003e\u003cimg src=\"https://segmentfault.com/img/bVcX4U4\" alt=\"image.png\" data-href=\"\" style=\"\"\u003e\u003cbr\u003e到此已经完成了提交代码自动打包的过程了，但是一看打包时间好家伙一分半，这要是实际开发大量依赖加入，那不得半个小时么？打开流程一看大部分时间都是在下载依赖，所以是不是可以添加缓存呢？一搜索果然有\u003ca href=\"https://link.segmentfault.com/?enc=pnQPaLLU4xUkEVZs%2FAOMvg%3D%3D.2tU0x25fYK3W5v%2BKIaXbPtcgPRdBA3aCtheR9dRUoYVvVXrZqh4THcigzp8RkBWk\" target=\"_blank\"\u003ecache\u003c/a\u003e,麻溜的按照文档添加进入，\u003cbr\u003e一看时间46s,哈哈果然有效。到此yml内容为\u003c/p\u003e\u003cpre style=\"text-align: start; line-height: 1.5;\"\u003e\u003ccode\u003ename: First GitHub Actions Demo\non: \n  push:\n    branches:\n      - master\n\njobs:\n  Build:\n    runs-on: ubuntu-latest\n    steps:\n    - name: checkout code\n      uses: actions/checkout@v2\n    - name: actions/setup-node@v2\n      uses: actions/setup-node@v2   \n      with:\n        node: 16.14\n    # 配置依赖缓存\n    - name: yarn cache\n      id: yarn-cahce-dir-path\n      run: echo \"::set-output name=dir::$(yarn cache dir)\"\n    - uses: actions/cache@v2\n      id: yarn-cache\n      with: \n        path: ${{ steps.yarn-cahce-dir-path.outputs.dir }}\n        key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}\n        restore-keys: | \n          ${{ runner.os }}-yarn-\n    - run: yarn install \u0026amp;\u0026amp; yarn build\u003c/code\u003e\u003c/pre\u003e\u003ch2 style=\"text-align: start;\"\u003e部署页面到Github Pages\u003c/h2\u003e\u003col style=\"text-align: start;\"\u003e\u003cli\u003e首先需要设定一个分支，当做站点的根目录，具体\u003ca href=\"https://link.segmentfault.com/?enc=VmP76VTiM%2BW%2BWDCp%2BCe%2BoQ%3D%3D.jjGmPHjENUgpLSpQUCjLgHZb4H9WteP7M1b8%2BsmlO6wkRYs7iMMi5X5gx4V3jda8WFrsrW7EPYw%2F0ARqadAHDW2cDfEmRicaQHdoj%2FsrssbgNcIGSjNimD2L2tqfO61ovyZJ7VdXGgATlEh37KyxRHVcdBEN3%2FFYiTDin%2B4GKvw%3D\" target=\"_blank\"\u003e设置文档\u003c/a\u003e，设置完成后会告诉你网站访问地址（ps: 一定要把仓库设置为Public,不然无法进行设置）。\u003c/li\u003e\u003c/ol\u003e\u003cp style=\"text-align: start;\"\u003e\u003cimg src=\"https://segmentfault.com/img/bVcX41W\" alt=\"image.png\" data-href=\"\" style=\"\"\u003e\u003c/p\u003e\u003col style=\"text-align: start;\"\u003e\u003cli\u003e按照文档编辑.yml,增加发布流程\u003c/li\u003e\u003c/ol\u003e\u003cpre style=\"text-align: start; line-height: 1.5;\"\u003e\u003ccode\u003e # 上面的步骤拿过来\n # 新增 deploy\n  - name: deploy\n    uses: JamesIves/github-pages-deploy-action@v4.2.3\n    with:\n      branch: gh-pages # 部署的分支名 有一定要独立一个分支，第一次设置为master 好家伙构建完成后，直接把我的项目文件清除了，只剩下打包的文件了。\n      folder: build   # build后文件目录\u003c/code\u003e\u003c/pre\u003e\u003cp style=\"text-align: start;\"\u003e效果\u003cbr\u003e\u003cimg src=\"https://segmentfault.com/img/bVcX42T\" alt=\"image.png\" data-href=\"\" style=\"\"\u003e\u003cbr\u003e到这里基本的目标已经实现了，但是当我看公司内部的流程时，install, build, deploy流程是分开的，这样有利于增加一些校验，lint规则等流程，所以我在思考怎么拆分流程呢，第一次我简单的拆分\u003c/p\u003e\u003cpre style=\"text-align: start; line-height: 1.5;\"\u003e\u003ccode\u003ename: First GitHub Actions Demo\non: \n  push:\n    branches:\n      - master\n      - dev\n\njobs:\n  Build:\n    runs-on: ubuntu-latest\n    steps:\n      uses: actions/checkout@v2\n      uses: actions/setup-node@v2   \n      with:\n        node: 16.14\n    - name: yarn cache\n      id: yarn-cahce-dir-path\n      run: echo \"::set-output name=dir::$(yarn cache dir)\"\n    - uses: actions/cache@v2\n      id: yarn-cache\n      with: \n        path: ${{ steps.yarn-cahce-dir-path.outputs.dir }}\n        key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}\n        restore-keys: | \n          ${{ runner.os }}-yarn-   \n    - run: yarn install\n    - run: yarn build\n  Deploy:\n    - name: depploy\n      uses: JamesIves/github-pages-deploy-action@v4.2.3\n      width:\n        branch: gh-pages\n        folder: build\n        clean: true\n        clean-exclude: |\n          special-file.txt\n          some/*.txt\n        ssh-key: ${{ secrets.PAGE_ACCESS_TOKEN }}    \u003c/code\u003e\u003c/pre\u003e\u003cp style=\"text-align: start;\"\u003e我想着这样应该就可以了，一提交代码直接GG,第一是没有Deploy没有等待build完成，第二是两个job之间的文件不能够直接用，又翻了下文档才发现官方给了这两个 actions/upload-artifact@v2 actions/download-artifact@v2 可以在不同job之间公用文件，所以又改了改,build阶段上传打包好的文件，deploy阶段下载打包好的文件进行部署（注意deploy也要使用checkout@v2）。\u003cbr\u003e最终结果\u003c/p\u003e\u003cpre style=\"text-align: start; line-height: 1.5;\"\u003e\u003ccode\u003ename: First GitHub Actions Demo\non: \n  push:\n    branches:\n      - master\n      - dev\n\njobs:\n  Build:\n    runs-on: ubuntu-latest\n    steps:\n    # 步骤名称\n    - name: checkout code\n      uses: actions/checkout@v2\n    - name: actions/setup-node@v2\n      uses: actions/setup-node@v2   \n      with:\n        node-version: '16.14'\n        cache: 'yarn'\n        cache-dependency-path: '**/yarn.lock'\n    # 缓存 有需要可以开启 同时 setu node 也可以进行缓存\n    # - name: yarn cache\n    #   id: yarn-cahce-dir-path\n    #   run: echo \"::set-output name=dir::$(yarn cache dir)\"\n    # - uses: actions/cache@v2\n    #   id: yarn-cache\n    #   with: \n    #     path: ${{ steps.yarn-cahce-dir-path.outputs.dir }}\n    #     key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}\n    #     restore-keys: | \n    #       ${{ runner.os }}-yarn-    \n    - run: yarn install \u0026amp;\u0026amp; yarn build  \n    # 上传打包好的文件，所以下一步可以使用\n    - name: upload files \n      uses: actions/upload-artifact@v2\n      with: \n        name: build-pages\n        path: build\n        retention-days: 1\n  Deploy: \n    needs: Build # 确保build 阶段完成\n    runs-on: ubuntu-latest\n    steps:\n      - name: checkout code\n        uses: actions/checkout@v2\n      - name: download build files\n        uses: actions/download-artifact@v2\n        with:\n          name: build-pages\n          path: build\n      - name: deploy\n        uses: JamesIves/github-pages-deploy-action@v4.2.3\n        with:\n          branch: gh-pages\n          folder: build \n          token: \"${{ secrets.DEPLOY_TOKEN }}\"  \u003c/code\u003e\u003c/pre\u003e\u003cp style=\"text-align: start;\"\u003e提交代码，查看运行结果，完成拆分。\u003cbr\u003e\u003cimg src=\"https://segmentfault.com/img/bVcX49V\" alt=\"image.png\" data-href=\"\" style=\"\"\u003e\u003cbr\u003e到这里可以愉快的访问你的网站了。\u003c/p\u003e\u003ch2 style=\"text-align: start;\"\u003e结尾\u003c/h2\u003e\u003cp style=\"text-align: start;\"\u003e写作思路是按照当时完成的思路一步一步的去完成这个流程来的，所以有些功能可能还没想到，同时如果流程有什么可以优化的地方，欢迎各位大佬指教。当然，完整的流程还欠缺很多，目前只是先完成简单的打包构建流程，接下来还需要去学习gitlab 的CI、CD,完成后会在水一篇文章。在之后才会去看一些部署项目相关的内容。比如Docker,Nginx等，希望能在空闲之余学会整个流程。加油！\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e","art_author":"yellow star","art_createtime":"2022-11-23T08:37:21.000Z","art_tags":4}},"__N_SSG":true},"page":"/artcontent/[aid]","query":{"aid":"98"},"buildId":"kRrtnNUirzJtMh_xDWC5r","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>