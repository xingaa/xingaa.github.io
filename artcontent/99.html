<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>深入理解HTTP缓存机制及原理</title><meta name="description" content="深入理解HTTP缓存机制及原理"/><link rel="icon" href="/CarStation.svg"/><meta name="google-site-verification" content="JPHZGs4Zk2iX0LKmv_kGBKtIfuo3rUJCO0AD6aP8bYc"/><meta name="next-head-count" content="6"/><link rel="preload" href="/_next/static/css/6e0c8d9ced1e22d0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e0c8d9ced1e22d0.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b24a9a06bb53618e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b24a9a06bb53618e.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-7180b5018c6594e2.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-a6a17768821d805e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-cc4289bbb2571876.js" defer=""></script><script src="/_next/static/chunks/647-2045c5df6fd5ed37.js" defer=""></script><script src="/_next/static/chunks/337-dc7edfac29e0cd58.js" defer=""></script><script src="/_next/static/chunks/pages/artcontent/%5Baid%5D-35eb7a1c749591f7.js" defer=""></script><script src="/_next/static/kRrtnNUirzJtMh_xDWC5r/_buildManifest.js" defer=""></script><script src="/_next/static/kRrtnNUirzJtMh_xDWC5r/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="rootPage"><div class="pageHeader" style="background-image:url(/_next/static/media/sea-bg.34630b96.jpg)"><div class="pageHeaderContent pageHeaderContent-detail">诗和远方</div></div><div class="layouts"><div class="layoutsmenu"><div class="layoutsmenufixed" style="height:0"><div class="players"><button type="button" class="ant-btn ant-btn-link layoutsButton"><span role="img" aria-label="home" class="anticon anticon-home"><svg viewBox="64 64 896 896" focusable="false" data-icon="home" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 00-44.4 0L77.5 505a63.9 63.9 0 00-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0018.7-45.3c0-17-6.7-33.1-18.8-45.2zM568 868H456V664h112v204zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3h-96.1z"></path></svg></span><span>主页</span></button><button type="button" class="ant-btn ant-btn-link layoutsButton"><span role="img" aria-label="snippets" class="anticon anticon-snippets"><svg viewBox="64 64 896 896" focusable="false" data-icon="snippets" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M832 112H724V72c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v40H500V72c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v40H320c-17.7 0-32 14.3-32 32v120h-96c-17.7 0-32 14.3-32 32v632c0 17.7 14.3 32 32 32h512c17.7 0 32-14.3 32-32v-96h96c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM664 888H232V336h218v174c0 22.1 17.9 40 40 40h174v338zm0-402H514V336h.2L664 485.8v.2zm128 274h-56V456L544 264H360v-80h68v32c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-32h152v32c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-32h68v576z"></path></svg></span><span>刷新页面</span></button><button type="button" class="ant-btn ant-btn-link layoutsButton"><span role="img" aria-label="github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0138.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></span><span>我的主页</span></button></div></div><div class="adminControl"><span class="adminControl-line1"></span><span class="adminControl-line2"><span class="adminControl-line4"></span></span><span class="adminControl-line3"></span></div></div><div class="layoutsMain"><div><main class="artcontent_main__Q2ogA"><h1>深入理解HTTP缓存机制及原理</h1><p>Loading ...</p><div class="artcontent_extra__RKNS4"><div>2022/11/25</div></div></main></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"datas":{"id":99,"art_title":"深入理解HTTP缓存机制及原理","art_content":"\u003ch3\u003e一、前言\u003c/h3\u003e\u003cp\u003e       上周阿里的面试官问了个面试题 “ 能不能说下 304 的过程，以及影响缓存的头部属性有哪些？”OMG.......因为之前只是大概了解 304 状态码是表示缓存，且因为平时项目开发过程中也没有在缓存这块踩过坑，所以这一块也没有去做特别深入的研究。所以当被问这个问题时，有被当头一棒的感觉，也好好反思了下，自己校招以软件开发工程师的职位进入公司，之前没有想过要从事前端开发，所以前端基础几乎可以忽略不计。工作一年多来，为在工作上表现突出，在工作上投入大量的精力，干到晚上10点是常规操作，周末至少加班1天；并且空余时间，经常看前端相关书籍弥补基础，如《JavaScript 高级程序设计》、《CSS 权威指南》、《Sass 实践》、《JavaScript 高性能编程》....《Webpack 实践》、《深入浅出 node.js》等不下10本书；在广度上涉及的还是很多的，但是存在问题：从事前端时间不长，前端知识杂而多，如果没有专门准备，如果突然问你一个知识点，你虽然大概知道这是啥，但是让你讲的话，你很难有条理的讲清楚。\u003c/p\u003e\u003cp\u003e       So，下一阶段的首要任务：“打好打牢前端基础，深入了解所用的技术栈原理”。废话少说，学问学问，不懂就弄清楚！以下“理论知识 + 实践操作”来彻底弄懂 HTTP 缓存机制及原理！\u003c/p\u003e\u003ch3\u003e二、缓存规则及解析\u003c/h3\u003e\u003cp\u003e       为方便大家理解，我假设览器存在一个缓存数据库，用于存储缓存信息。在客户端第一次请求数据时，此时缓存数据库中没有对应的缓存数据，需要请求服务器，服务器返回后，将数据存储至缓存数据库中。如下流程图所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a1125a6943e17~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003c/p\u003e\u003cp\u003e       根据是否需要重新向服务器发起请求来分类，将HTTP缓存规则分为两大类(\u003cstrong\u003e强制缓存\u003c/strong\u003e，\u003cstrong\u003e对比缓存\u003c/strong\u003e)在详细介绍这两种规则之前，先通过时序图的方式，让大家对这两种规则有个简单了解。\u003c/p\u003e\u003cp\u003e（1）已存在缓存数据时，仅基于\u003cstrong\u003e强制缓存\u003c/strong\u003e，请求数据的流程如下所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a1131a01649ce~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e（2）已存在缓存数据时，仅基于\u003cstrong\u003e对比缓存\u003c/strong\u003e，请求数据的流程如下所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a113789f814d2~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e       我们可以看到两类缓存规则的不同，\u003cstrong\u003e强制缓存\u003c/strong\u003e如果生效，不需要再和服务器发生交互，而\u003cstrong\u003e对比缓存\u003c/strong\u003e不管是否生效，都需要与服务端发生交互。\u003c/p\u003e\u003cp\u003e       两类缓存规则可以同时存在，\u003cstrong\u003e强制缓存\u003c/strong\u003e优先级高于\u003cstrong\u003e对比缓存\u003c/strong\u003e，也就是说，当执行\u003cstrong\u003e强制缓存\u003c/strong\u003e的规则时，如果缓存生效，直接使用缓存，不再执行\u003cstrong\u003e对比缓存\u003c/strong\u003e规则。\u003c/p\u003e\u003ch3\u003e三、缓存常用字段\u003c/h3\u003e\u003ch3\u003e1、http1.0时期的缓存方案\u003c/h3\u003e\u003cp\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a119737ecdeb2~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e注意： \u003c/p\u003e\u003cp\u003e（1）如果使用了\u003ccode\u003ePragma: 'no-cache'\u003c/code\u003e的话，再设置\u003ccode\u003eExpires\u003c/code\u003e或者\u003ccode\u003eCache-Control\u003c/code\u003e，就没有用了，说明\u003ccode\u003ePragma\u003c/code\u003e的权值比后两者高。\u003c/p\u003e\u003cp\u003e （2）如果设置了\u003ccode\u003eExpires\u003c/code\u003e之后，客户端在需要请求数据的时候，首先会对比当前系统时间和这个\u003ccode\u003eExpires\u003c/code\u003e时间，如果没有超过\u003ccode\u003eExpires\u003c/code\u003e时间，则直接读取本地磁盘中的缓存数据，不发送请求。\u003cbr\u003e\u003c/p\u003e\u003ch3\u003e2、http1.1 时期的缓存方案\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003e2.1、Cache-Control 字段 \u003c/strong\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e2.1.1、Cache-Control 作为请求头字段\u003c/strong\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a11b7c6a465ba~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e（1）Cache-Control: no-cache \u003c/strong\u003e\u003c/p\u003e\u003cp\u003e使用\u003ccode\u003eno-cache\u003c/code\u003e指令的目的是为了防止从缓存中返回过期的资源。 客户端发送的请求中如果包含 \u003ccode\u003eno-cache\u003c/code\u003e 指令，则表示客户端将不会接收缓存的资源。每次请求都是从服务器获取资源，返回304。\u003cbr\u003e \u003c/p\u003e\u003cp\u003e\u003cstrong\u003e（2）Cache-Control: no-store \u003c/strong\u003e\u003c/p\u003e\u003cp\u003e使用\u003ccode\u003eno-store\u003c/code\u003e 指令表示请求的资源不会被缓存，下次任何其它请求获取该资源，还是会从服务器获取，返回 200，即资源本身。\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e2.1.2、Cache-Control 作为响应头字段\u003c/strong\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a11c6b7651b77~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eCache-Control: public \u003c/strong\u003e\u003c/p\u003e\u003cp\u003e当指定使用 \u003ccode\u003epublic \u003c/code\u003e指令时，则明确表明其他用户也可利用缓存。\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e Cache-Control: private\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e当指定 \u003ccode\u003eprivate\u003c/code\u003e 指令后，响应只以特定的用户作为对象，这与 \u003ccode\u003epublic\u003c/code\u003e 指令的行为相反。 缓存服务器会对该特定用户提供资源缓存的服务，对于其他用户发送 过来的请求，代理服务器则不会返回缓存。\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e Cache-Control: no-cache \u003c/strong\u003e\u003c/p\u003e\u003cp\u003e如果服务器返回的响应中包含\u003ccode\u003e no-cache \u003c/code\u003e指令，每次客户端请求，必需先向服务器确认其有效性，如果资源没有更改，则返回304. \u003c/p\u003e\u003cp\u003e\u003cstrong\u003eCache-Control: no-store \u003c/strong\u003e\u003c/p\u003e\u003cp\u003e不对响应的资源进行缓存，即用户下次请求还是返回 200，返回资源本身。 \u003c/p\u003e\u003cp\u003e\u003cstrong\u003eCache-Control: max-age=604800（单位：秒） \u003c/strong\u003e\u003c/p\u003e\u003cp\u003e资源缓存在本地浏览器的时间，如果超过该时间，则重新向服务器获取。\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e2.2、请求头部字段 \u0026 响应头部字段\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e2.2.1、请求头部字段\u003c/strong\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a11dbaa0f8a2a~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e2.2.2、响应头部字段\u003c/strong\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a11e177c975f2~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e注意：\u003c/p\u003e\u003cp\u003e （1）\u003ccode\u003eIf-None-Match\u003c/code\u003e的优先级比\u003ccode\u003eIf-Modified-Since\u003c/code\u003e高，所以两者同时存在时，遵从前者。\u003cbr\u003e\u003c/p\u003e\u003ch3\u003e四、实验验证\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003e1、实验1 — 请求的资源没修改，验证2种缓存出现的情形\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e服务端使用 node.js ， 客户端使用 axios 进行请求：\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e1.1、请求头部 / 响应头部 设置\u003cbr\u003e\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e（1）服务端响应头部设置：\u003c/p\u003e\u003cp\u003e     res.setHeader('Cache-Control', 'public, max-age=10');\u003c/p\u003e\u003cp\u003e（2）客户端请求头部使用默认设置\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e1.2、实验步骤\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e（1）请求 3 次，第一次请求请求资源；第二次在10秒内再次请求该资源，第三次在 10 秒后再次请求该资源（实验过程中，服务端的资源没有进行改变）\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e1.3、实验结果\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e      3 次请求的 HTTP 信息如下图所示，从图中的信息可以得出，第一次请求该资源是从服务器获取；第二次（10 秒内）请求该资源是直接从浏览器缓存中获取该资源（没有向服务器确认）；第三次（10 秒后）请求该资源时，因为资源缓存时间（10 秒）过期，所以向服务器获取资源，服务器判断该资源与本地缓存的资源没有做更改，所以返回 304，让客户端直接从浏览器缓存中获取该资源；以下，根据 HTTP 头部信息详细介绍三个操作的交互过程。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a11ff1e022d96~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e1.3.1、第一次请求资源\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e 第一次请求资源的请求头部和响应头部的截图如下所示，因为第一次请求该资源，本地并没有缓存，所以直接从服务器获取该资源；我们从截图可以看到，服务器返回改资源的响应头部中包含3个属性与资源缓存相关：\u003c/p\u003e\u003cp\u003e（1）cache-control: public, max-age=10\u003c/p\u003e\u003cp\u003e \u0026nbsp; \u0026nbsp; 缓存规则的设置，我们这个示例中，设置缓存规则为 public, 并且设置缓存过期时间为10秒；\u003c/p\u003e\u003cp\u003e（2）etag: W/\"95f15b-16994d7ebf6\"\u003c/p\u003e\u003cp\u003e \u0026nbsp; \u0026nbsp; 资源的唯一标识符，客户端下次访问该资源时，会在请求头中携带 etag 去向服务器确认，该资源是否被修改；\u003c/p\u003e\u003cp\u003e（3）last-modified: Tue, 19 Mar 2019 07:26:12 GMT\u003c/p\u003e\u003cp\u003e \u0026nbsp; \u0026nbsp; 资源最后一次修改时间，客户端下次访问该资源时，会在请求头中携带该信息去向服务器进行匹配，该资源是否被修改；\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a12072e2e0cb6~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e1.3.2、第二次请求资源（10秒内，即在缓存时间失效前）\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e       第二次请求资源的请求头部和响应头部的截图如下所示，因为第二次请求该资源，该资源本地缓存还没失效，所以就直接从浏览器缓存中获取该资源。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a120bbf711005~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e1.3.3、第三次请求资源（10秒后，即在缓存时间失效后）\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e       第三次请求资源的请求头部和响应头部的截图如下所示，因为第三次请求该资源，该资源本地缓存已经失效，所以在请求头部中加入 If-Modified-Since 和 If-None-Match 属性，来向服务器进行确认该资源是否有被更改。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a1211c38c875b~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e2、实验2 — 请求的资源进行修改，验证2种缓存出现的情形\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e服务端使用 node.js ， 客户端使用 axios 进行请求：\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e2.1、请求头部 / 响应头部 设置\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e（1）服务端响应头部设置：\u003c/p\u003e\u003cp\u003e     res.setHeader('Cache-Control', 'public, max-age=20');\u003c/p\u003e\u003cp\u003e（2）客户端请求头部使用默认设置\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e2.2、实验步骤\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e（1）请求 3 次，第一次请求资源；然后在服务器对请求的资源进行修改，第二次在 20 秒内再次请求该资源，第三次在 20 秒后再次请求该资源\u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e2.3、实验结果\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e       3 次请求的 HTTP 信息如下图所示，从图中的信息可以得出，第一次请求该资源是从服务器获取；第二次（20 秒内）请求该资源是直接从浏览器缓存中获取该资源（没有向服务器确认）；第三次（20 秒后）请求该资源时，因为资源缓存时间（20 秒）过期，所以向服务器获取资源，服务器判断该资源与本地缓存的资源不同，所以重新返回该资源；以下，根据 HTTP 头部信息详细介绍三个操作的交互过程。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a121606944373~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e2.3.1、第一次请求资源\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e       第一次请求资源的请求头部和响应头部的截图如下所示，具体详细信息与 1.3.1 小节相同，在此不同重复介绍。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a1219166741f1~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e2.3.2、第二次请求资源（20 秒内，即在缓存时间失效前）\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e      第二次请求资源的请求头部和响应头部的截图如下所示，（注意：即使此时服务器上的资源已经更改，但是由于缓存在浏览器中的资源没有过期，所以还是从缓存中返回旧资源）。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a121db9c73552~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e2.3.3、第三次请求资源（20 秒后，即在缓存时间失效后）\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e       第三次请求资源的请求头部和响应头部的截图如下所示，因为第三次请求该资源，该资源本地缓存已经失效，所以在请求头部中加入 If-Modified-Since 和 If-None-Match 属性，来向服务器进行确认该资源是否有被更改，从下图中可以看到，响应头部的属性 etag 与 请求头部的属性 If-None-Match \u0026nbsp;不同，响应头部的属性 If-Modified-Since 与 请求头部的属性 last-modified 不同；所以服务器返回该资源的最新资源。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a1221529a99db~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cbr\u003e\u003c/p\u003e\u003ch3\u003e五、总结\u003c/h3\u003e\u003cp\u003e1、对于强制缓存，服务器通知浏览器一个缓存时间，在缓存时间内，下次请求，直接用缓存，不在时间内，执行比较缓存策略。\u003c/p\u003e\u003cp\u003e2、对于比较缓存，将缓存信息中的Etag和Last-Modified通过请求发送给服务器，由服务器校验，返回304状态码时，浏览器直接使用缓存。\u003c/p\u003e\u003cp\u003e总结流程图如下所示：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a12255df4532a~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a123d14bbb808~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cem\u003e有任何问题欢迎留言讨论，如果觉得对你有帮助，请点赞鼓励~\u003c/em\u003e\u003cimg src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/22/169a123d14bbb808~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image\" alt=\"\" data-href=\"\" style=\"\"/\u003e\u003cbr\u003e\u003c/p\u003e\u003cp\u003e作者：我是你的超级英雄\u003cbr\u003e链接：https://juejin.cn/post/6844903801778864136\u003cbr\u003e来源：稀土掘金\u003c/p\u003e","art_author":"yellow star","art_createtime":"2022-11-25T02:33:28.000Z","art_tags":4}},"__N_SSG":true},"page":"/artcontent/[aid]","query":{"aid":"99"},"buildId":"kRrtnNUirzJtMh_xDWC5r","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>