<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>GitHub Actions 入门教程</title><meta name="description" content="GitHub Actions 入门教程"/><link rel="icon" href="/CarStation.svg"/><meta name="google-site-verification" content="JPHZGs4Zk2iX0LKmv_kGBKtIfuo3rUJCO0AD6aP8bYc"/><meta name="next-head-count" content="6"/><link rel="preload" href="/_next/static/css/6e0c8d9ced1e22d0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e0c8d9ced1e22d0.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b24a9a06bb53618e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b24a9a06bb53618e.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-7180b5018c6594e2.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-a6a17768821d805e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-cc4289bbb2571876.js" defer=""></script><script src="/_next/static/chunks/647-2045c5df6fd5ed37.js" defer=""></script><script src="/_next/static/chunks/337-dc7edfac29e0cd58.js" defer=""></script><script src="/_next/static/chunks/pages/artcontent/%5Baid%5D-35eb7a1c749591f7.js" defer=""></script><script src="/_next/static/kRrtnNUirzJtMh_xDWC5r/_buildManifest.js" defer=""></script><script src="/_next/static/kRrtnNUirzJtMh_xDWC5r/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="rootPage"><div class="pageHeader" style="background-image:url(/_next/static/media/sea-bg.34630b96.jpg)"><div class="pageHeaderContent pageHeaderContent-detail">诗和远方</div></div><div class="layouts"><div class="layoutsmenu"><div class="layoutsmenufixed" style="height:0"><div class="players"><button type="button" class="ant-btn ant-btn-link layoutsButton"><span role="img" aria-label="home" class="anticon anticon-home"><svg viewBox="64 64 896 896" focusable="false" data-icon="home" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 00-44.4 0L77.5 505a63.9 63.9 0 00-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0018.7-45.3c0-17-6.7-33.1-18.8-45.2zM568 868H456V664h112v204zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3h-96.1z"></path></svg></span><span>主页</span></button><button type="button" class="ant-btn ant-btn-link layoutsButton"><span role="img" aria-label="snippets" class="anticon anticon-snippets"><svg viewBox="64 64 896 896" focusable="false" data-icon="snippets" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M832 112H724V72c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v40H500V72c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v40H320c-17.7 0-32 14.3-32 32v120h-96c-17.7 0-32 14.3-32 32v632c0 17.7 14.3 32 32 32h512c17.7 0 32-14.3 32-32v-96h96c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM664 888H232V336h218v174c0 22.1 17.9 40 40 40h174v338zm0-402H514V336h.2L664 485.8v.2zm128 274h-56V456L544 264H360v-80h68v32c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-32h152v32c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-32h68v576z"></path></svg></span><span>刷新页面</span></button><button type="button" class="ant-btn ant-btn-link layoutsButton"><span role="img" aria-label="github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0138.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></span><span>我的主页</span></button></div></div><div class="adminControl"><span class="adminControl-line1"></span><span class="adminControl-line2"><span class="adminControl-line4"></span></span><span class="adminControl-line3"></span></div></div><div class="layoutsMain"><div><main class="artcontent_main__Q2ogA"><h1>GitHub Actions 入门教程</h1><p>Loading ...</p><div class="artcontent_extra__RKNS4"><div>2022/11/22</div></div></main></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"datas":{"id":96,"art_title":"GitHub Actions 入门教程","art_content":"\u003ch1 style=\"text-align: left;\"\u003e阮一峰大神的入门教学，全文copy👨‍💻\u003c/h1\u003e\u003cp\u003e \u003ca href=\"https://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html\" target=\"_blank\"\u003ehttps://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html\u003c/a\u003e \u003c/p\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e作者： \u003ca href=\"https://www.ruanyifeng.com/\" target=\"\" style=\"text-align: left;\"\u003e阮一峰\u003c/a\u003e\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e日期： \u003ca href=\"https://www.ruanyifeng.com/blog/2019/09/\" target=\"\" style=\"text-align: left;\"\u003e2019年9月12日\u003c/a\u003e\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003cbr\u003e\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003ca href=\"https://github.com/features/actions\" target=\"_blank\" style=\"text-align: left;\"\u003eGitHub Actions\u003c/a\u003e 是 GitHub 的\u003ca href=\"https://www.ruanyifeng.com/blog/2015/09/continuous-integration.html\" target=\"_blank\" style=\"text-align: left;\"\u003e持续集成服务\u003c/a\u003e，于2018年10月\u003ca href=\"https://github.blog/changelog/2018-10-16-github-actions-limited-beta/\" target=\"_blank\" style=\"text-align: left;\"\u003e推出\u003c/a\u003e。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e这些天，我一直在试用，觉得它非常强大，有创意，比 \u003ca href=\"https://www.ruanyifeng.com/blog/2017/12/travis_ci_tutorial.html\" target=\"_blank\" style=\"text-align: left;\"\u003eTravis CI\u003c/a\u003e 玩法更多。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e本文是一个简单教程，演示如何使用 GitHub Actions 自动发布一个 React 应用到 \u003ca href=\"https://www.ruanyifeng.com/blog/2012/08/blogging_with_jekyll.html\" target=\"_blank\" style=\"text-align: left;\"\u003eGitHub Pages\u003c/a\u003e。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003cimg src=\"https://www.wangbase.com/blogimg/asset/201909/bg2019091201.jpg\" alt=\"\" data-href=\"\" style=\"\"\u003e\u003c/p\u003e\u003ch2 style=\"text-align: left;\"\u003e一、GitHub Actions 是什么？\u003c/h2\u003e\u003cp style=\"text-align: left;\"\u003e大家知道，持续集成由很多操作组成，比如抓取代码、运行测试、登录远程服务器，发布到第三方服务等等。GitHub 把这些操作就称为 actions。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e很多操作在不同项目里面是类似的，完全可以共享。GitHub 注意到了这一点，想出了一个很妙的点子，允许开发者把每个操作写成独立的脚本文件，存放到代码仓库，使得其他开发者可以引用。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e如果你需要某个 action，不必自己写复杂的脚本，直接引用他人写好的 action 即可，整个持续集成过程，就变成了一个 actions 的组合。这就是 GitHub Actions 最特别的地方。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003eGitHub 做了一个\u003ca href=\"https://github.com/marketplace?type=actions\" target=\"_blank\" style=\"text-align: left;\"\u003e官方市场\u003c/a\u003e，可以搜索到他人提交的 actions。另外，还有一个 \u003ca href=\"https://github.com/sdras/awesome-actions\" target=\"_blank\" style=\"text-align: left;\"\u003eawesome actions\u003c/a\u003e 的仓库，也可以找到不少 action。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003cimg src=\"https://www.wangbase.com/blogimg/asset/201909/bg2019091105.jpg\" alt=\"\" data-href=\"\" style=\"\"\u003e\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e上面说了，每个 action 就是一个独立脚本，因此可以做成代码仓库，使用\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003euserName/repoName\u003c/code\u003e\u003c/span\u003e的语法引用 action。比如，\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003eactions/setup-node\u003c/code\u003e\u003c/span\u003e就表示\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003egithub.com/actions/setup-node\u003c/code\u003e\u003c/span\u003e这个\u003ca href=\"https://github.com/actions/setup-node\" target=\"_blank\" style=\"text-align: left;\"\u003e仓库\u003c/a\u003e，它代表一个 action，作用是安装 Node.js。事实上，GitHub 官方的 actions 都放在 \u003ca href=\"https://github.com/actions\" target=\"_blank\" style=\"text-align: left;\"\u003egithub.com/actions\u003c/a\u003e 里面。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e既然 actions 是代码仓库，当然就有版本的概念，用户可以引用某个具体版本的 action。下面都是合法的 action 引用，用的就是 Git 的指针概念，详见\u003ca href=\"https://help.github.com/en/articles/about-actions#versioning-your-action\" target=\"_blank\" style=\"text-align: left;\"\u003e官方文档\u003c/a\u003e。\u003c/p\u003e\u003cblockquote style=\"text-align: left;\"\u003eactions/setup-node@74bc508 # 指向一个 commit actions/setup-node@v1.0 # 指向一个标签 actions/setup-node@master # 指向一个分支\u003c/blockquote\u003e\u003ch2 style=\"text-align: left;\"\u003e二、基本概念\u003c/h2\u003e\u003cp style=\"text-align: left;\"\u003eGitHub Actions 有一些自己的术语。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e（1）\u003cstrong\u003eworkflow\u003c/strong\u003e （工作流程）：持续集成一次运行的过程，就是一个 workflow。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e（2）\u003cstrong\u003ejob\u003c/strong\u003e （任务）：一个 workflow 由一个或多个 jobs 构成，含义是一次持续集成的运行，可以完成多个任务。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e（3）\u003cstrong\u003estep\u003c/strong\u003e（步骤）：每个 job 由多个 step 构成，一步步完成。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e（4）\u003cstrong\u003eaction\u003c/strong\u003e （动作）：每个 step 可以依次执行一个或多个命令（action）。\u003c/p\u003e\u003ch2 style=\"text-align: left;\"\u003e三、workflow 文件\u003c/h2\u003e\u003cp style=\"text-align: left;\"\u003eGitHub Actions 的配置文件叫做 workflow 文件，存放在代码仓库的\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003e.github/workflows\u003c/code\u003e\u003c/span\u003e目录。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003eworkflow 文件采用 \u003ca href=\"https://www.ruanyifeng.com/blog/2016/07/yaml.html\" target=\"_blank\" style=\"text-align: left;\"\u003eYAML 格式\u003c/a\u003e，文件名可以任意取，但是后缀名统一为\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003e.yml\u003c/code\u003e\u003c/span\u003e，比如\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003efoo.yml\u003c/code\u003e\u003c/span\u003e。一个库可以有多个 workflow 文件。GitHub 只要发现\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003e.github/workflows\u003c/code\u003e\u003c/span\u003e目录里面有\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003e.yml\u003c/code\u003e\u003c/span\u003e文件，就会自动运行该文件。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003eworkflow 文件的配置字段非常多，详见\u003ca href=\"https://help.github.com/en/articles/workflow-syntax-for-github-actions\" target=\"_blank\" style=\"text-align: left;\"\u003e官方文档\u003c/a\u003e。下面是一些基本字段。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003ccode\u003e\u003cstrong\u003e（1）name\u003c/strong\u003e\u003c/code\u003e\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ename\u003c/code\u003e\u003c/span\u003e字段是 workflow 的名称。如果省略该字段，默认为当前 workflow 的文件名。\u003c/p\u003e\u003cblockquote style=\"text-align: left;\"\u003ename: GitHub Actions Demo\u003c/blockquote\u003e\u003cp style=\"text-align: left;\"\u003e\u003ccode\u003e\u003cstrong\u003e（2）on\u003c/strong\u003e\u003c/code\u003e\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003eon\u003c/code\u003e\u003c/span\u003e字段指定触发 workflow 的条件，通常是某些事件。\u003c/p\u003e\u003cblockquote style=\"text-align: left;\"\u003eon: push\u003c/blockquote\u003e\u003cp style=\"text-align: left;\"\u003e上面代码指定，\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003epush\u003c/code\u003e\u003c/span\u003e事件触发 workflow。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003eon\u003c/code\u003e\u003c/span\u003e字段也可以是事件的数组。\u003c/p\u003e\u003cblockquote style=\"text-align: left;\"\u003eon: [push, pull_request]\u003c/blockquote\u003e\u003cp style=\"text-align: left;\"\u003e上面代码指定，\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003epush\u003c/code\u003e\u003c/span\u003e事件或\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003epull_request\u003c/code\u003e\u003c/span\u003e事件都可以触发 workflow。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e完整的事件列表，请查看\u003ca href=\"https://help.github.com/en/articles/events-that-trigger-workflows\" target=\"_blank\" style=\"text-align: left;\"\u003e官方文档\u003c/a\u003e。除了代码库事件，GitHub Actions 也支持外部事件触发，或者定时运行。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003ccode\u003e\u003cstrong\u003e（3）on.\u0026lt;push|pull_request\u0026gt;.\u0026lt;tags|branches\u0026gt;\u003c/strong\u003e\u003c/code\u003e\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e指定触发事件时，可以限定分支或标签。\u003c/p\u003e\u003cblockquote style=\"text-align: left;\"\u003eon: push: branches: - master\u003c/blockquote\u003e\u003cp style=\"text-align: left;\"\u003e上面代码指定，只有\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003emaster\u003c/code\u003e\u003c/span\u003e分支发生\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003epush\u003c/code\u003e\u003c/span\u003e事件时，才会触发 workflow。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003ccode\u003e\u003cstrong\u003e（4）jobs.\u0026lt;job_id\u0026gt;.name\u003c/strong\u003e\u003c/code\u003e\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003eworkflow 文件的主体是\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ejobs\u003c/code\u003e\u003c/span\u003e字段，表示要执行的一项或多项任务。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ejobs\u003c/code\u003e\u003c/span\u003e字段里面，需要写出每一项任务的\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ejob_id\u003c/code\u003e\u003c/span\u003e，具体名称自定义。\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ejob_id\u003c/code\u003e\u003c/span\u003e里面的\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ename\u003c/code\u003e\u003c/span\u003e字段是任务的说明。\u003c/p\u003e\u003cblockquote style=\"text-align: left;\"\u003ejobs: my_first_job: name: My first job my_second_job: name: My second job\u003c/blockquote\u003e\u003cp style=\"text-align: left;\"\u003e上面代码的\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ejobs\u003c/code\u003e\u003c/span\u003e字段包含两项任务，\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ejob_id\u003c/code\u003e\u003c/span\u003e分别是\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003emy_first_job\u003c/code\u003e\u003c/span\u003e和\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003emy_second_job\u003c/code\u003e\u003c/span\u003e。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003ccode\u003e\u003cstrong\u003e（5）jobs.\u0026lt;job_id\u0026gt;.needs\u003c/strong\u003e\u003c/code\u003e\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003eneeds\u003c/code\u003e\u003c/span\u003e字段指定当前任务的依赖关系，即运行顺序。\u003c/p\u003e\u003cblockquote style=\"text-align: left;\"\u003ejobs: job1: job2: needs: job1 job3: needs: [job1, job2]\u003c/blockquote\u003e\u003cp style=\"text-align: left;\"\u003e上面代码中，\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ejob1\u003c/code\u003e\u003c/span\u003e必须先于\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ejob2\u003c/code\u003e\u003c/span\u003e完成，而\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ejob3\u003c/code\u003e\u003c/span\u003e等待\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ejob1\u003c/code\u003e\u003c/span\u003e和\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ejob2\u003c/code\u003e\u003c/span\u003e的完成才能运行。因此，这个 workflow 的运行顺序依次为：\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ejob1\u003c/code\u003e\u003c/span\u003e、\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ejob2\u003c/code\u003e\u003c/span\u003e、\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ejob3\u003c/code\u003e\u003c/span\u003e。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003ccode\u003e\u003cstrong\u003e（6）jobs.\u0026lt;job_id\u0026gt;.runs-on\u003c/strong\u003e\u003c/code\u003e\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003eruns-on\u003c/code\u003e\u003c/span\u003e字段指定运行所需要的虚拟机环境。它是必填字段。目前可用的虚拟机如下。\u003c/p\u003e\u003cblockquote style=\"text-align: left;\"\u003eubuntu-latest，ubuntu-18.04或ubuntu-16.04windows-latest，windows-2019或windows-2016macOS-latest或macOS-10.14\u003c/blockquote\u003e\u003cp style=\"text-align: left;\"\u003e下面代码指定虚拟机环境为\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003eubuntu-18.04\u003c/code\u003e\u003c/span\u003e。\u003c/p\u003e\u003cblockquote style=\"text-align: left;\"\u003eruns-on: ubuntu-18.04\u003c/blockquote\u003e\u003cp style=\"text-align: left;\"\u003e\u003ccode\u003e\u003cstrong\u003e（7）jobs.\u0026lt;job_id\u0026gt;.steps\u003c/strong\u003e\u003c/code\u003e\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003esteps\u003c/code\u003e\u003c/span\u003e字段指定每个 Job 的运行步骤，可以包含一个或多个步骤。每个步骤都可以指定以下三个字段。\u003c/p\u003e\u003cblockquote style=\"text-align: left;\"\u003ejobs.\u0026lt;job_id\u0026gt;.steps.name：步骤名称。jobs.\u0026lt;job_id\u0026gt;.steps.run：该步骤运行的命令或者 action。jobs.\u0026lt;job_id\u0026gt;.steps.env：该步骤所需的环境变量。\u003c/blockquote\u003e\u003cp style=\"text-align: left;\"\u003e下面是一个完整的 workflow 文件的范例。\u003c/p\u003e\u003cblockquote style=\"text-align: left;\"\u003ename: Greeting from Mona on: push jobs: my-job: name: My Job runs-on: ubuntu-latest steps: - name: Print a greeting env: MY_VAR: Hi there! My name is FIRST_NAME: Mona MIDDLE_NAME: The LAST_NAME: Octocat run: | echo $MY_VAR $FIRST_NAME $MIDDLE_NAME $LAST_NAME.\u003c/blockquote\u003e\u003cp style=\"text-align: left;\"\u003e上面代码中，\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003esteps\u003c/code\u003e\u003c/span\u003e字段只包括一个步骤。该步骤先注入四个环境变量，然后执行一条 Bash 命令。\u003c/p\u003e\u003ch2 style=\"text-align: left;\"\u003e四、实例：React 项目发布到 GitHub Pages\u003c/h2\u003e\u003cp style=\"text-align: left;\"\u003e下面是一个实例，通过 GitHub Actions 构建一个 React 项目，并发布到 GitHub Pages。最终代码都在\u003ca href=\"https://github.com/ruanyf/github-actions-demo\" target=\"_blank\" style=\"text-align: left;\"\u003e这个仓库\u003c/a\u003e里面，发布后的参考网址为\u003ca href=\"https://ruanyf.github.io/github-actions-demo\" target=\"_blank\" style=\"text-align: left;\"\u003eruanyf.github.io/github-actions-demo\u003c/a\u003e。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e第一步，GitHub Actions 目前还处在测试阶段，需要到\u003ca href=\"https://github.com/features/actions/signup/\" target=\"_blank\" style=\"text-align: left;\"\u003e这个网址\u003c/a\u003e申请测试资格。申请以后，可能需要几天才能通过。据说，2019年11月就会放开。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e获得资格后，仓库顶部的菜单会出现\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003eActions\u003c/code\u003e\u003c/span\u003e一项。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003cimg src=\"https://www.wangbase.com/blogimg/asset/201909/bg2019091106.jpg\" alt=\"\" data-href=\"\" style=\"\"\u003e\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e第二步，这个示例需要将构建成果发到 GitHub 仓库，因此需要 GitHub 密钥。按照\u003ca href=\"https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line\" target=\"_blank\" style=\"text-align: left;\"\u003e官方文档\u003c/a\u003e，生成一个密钥。然后，将这个密钥储存到当前仓库的\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003eSettings/Secrets\u003c/code\u003e\u003c/span\u003e里面。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003cimg src=\"https://www.wangbase.com/blogimg/asset/201909/bg2019091107.jpg\" alt=\"\" data-href=\"\" style=\"\"\u003e\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e上图是储存秘密的环境变量的地方。环境变量的名字可以随便起，这里用的是\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003eACCESS_TOKEN\u003c/code\u003e\u003c/span\u003e。如果你不用这个名字，后面脚本里的变量名也要跟着改。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e第三步，本地计算机使用\u003ca href=\"https://github.com/facebook/create-react-app\" target=\"_blank\" style=\"text-align: left;\"\u003e\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ecreate-react-app\u003c/code\u003e\u003c/span\u003e\u003c/a\u003e，生成一个标准的 React 应用。\u003c/p\u003e\u003cblockquote style=\"text-align: left;\"\u003e$ npx create-react-app github-actions-demo $ cd github-actions-demo\u003c/blockquote\u003e\u003cp style=\"text-align: left;\"\u003e然后，打开\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003epackage.json\u003c/code\u003e\u003c/span\u003e文件，加一个\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003ehomepage\u003c/code\u003e\u003c/span\u003e字段，表示该应用发布后的根目录（参见\u003ca href=\"https://create-react-app.dev/docs/deployment#building-for-relative-paths\" target=\"_blank\" style=\"text-align: left;\"\u003e官方文档\u003c/a\u003e）。\u003c/p\u003e\u003cblockquote style=\"text-align: left;\"\u003e\"homepage\": \"https://[username].github.io/github-actions-demo\",\u003c/blockquote\u003e\u003cp style=\"text-align: left;\"\u003e上面代码中，将\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003e[username]\u003c/code\u003e\u003c/span\u003e替换成你的 GitHub 用户名，参见\u003ca href=\"https://github.com/ruanyf/github-actions-demo/blob/master/package.json#L10\" target=\"_blank\" style=\"text-align: left;\"\u003e范例\u003c/a\u003e。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e第四步，在这个仓库的\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003e.github/workflows\u003c/code\u003e\u003c/span\u003e目录，生成一个 workflow 文件，名字可以随便取，这个示例是\u003cspan style=\"color: rgb(17, 17, 17); background-color: pink;\"\u003e\u003ccode\u003eci.yml\u003c/code\u003e\u003c/span\u003e。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e我们选用一个别人已经写好的 action：\u003ca href=\"https://github.com/marketplace/actions/deploy-to-github-pages\" target=\"_blank\" style=\"text-align: left;\"\u003eJamesIves/github-pages-deploy-action\u003c/a\u003e，它提供了 workflow 的范例文件，直接拷贝过来就行了（查看\u003ca href=\"https://github.com/ruanyf/github-actions-demo/blob/master/.github/workflows/ci.yml\" target=\"_blank\" style=\"text-align: left;\"\u003e源码\u003c/a\u003e）。\u003c/p\u003e\u003cblockquote style=\"text-align: left;\"\u003ename: GitHub Actions Build and Deploy Demo on: push: branches: - master jobs: build-and-deploy: runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@master - name: Build and Deploy uses: JamesIves/github-pages-deploy-action@master env: ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }} BRANCH: gh-pages FOLDER: build BUILD_SCRIPT: npm install \u0026amp;\u0026amp; npm run build\u003c/blockquote\u003e\u003cp style=\"text-align: left;\"\u003e上面这个 workflow 文件的要点如下。\u003c/p\u003e\u003cblockquote style=\"text-align: left;\"\u003e整个流程在master分支发生push事件时触发。只有一个job，运行在虚拟机环境ubuntu-latest。第一步是获取源码，使用的 action 是actions/checkout。第二步是构建和部署，使用的 action 是JamesIves/github-pages-deploy-action。第二步需要四个环境变量，分别为 GitHub 密钥、发布分支、构建成果所在目录、构建脚本。其中，只有 GitHub 密钥是秘密变量，需要写在双括号里面，其他三个都可以直接写在文件里。\u003c/blockquote\u003e\u003cp style=\"text-align: left;\"\u003e第五步，保存上面的文件后，将整个仓库推送到 GitHub。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003eGitHub 发现了 workflow 文件以后，就会自动运行。你可以在网站上实时查看\u003ca href=\"https://github.com/ruanyf/github-actions-demo/commit/24fbf6a875351297f31434fd44bc3146accf9e59/checks\" target=\"_blank\" style=\"text-align: left;\"\u003e运行日志\u003c/a\u003e，日志默认保存30天。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003cimg src=\"https://www.wangbase.com/blogimg/asset/201909/bg2019091108.jpg\" alt=\"\" data-href=\"\" style=\"\"\u003e\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e等到 workflow 运行结束，访问 \u003ca href=\"https://ruanyf.github.io/github-actions-demo/\" target=\"_blank\" style=\"text-align: left;\"\u003eGitHub Page\u003c/a\u003e，会看到构建成果已经发上网了。\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003cimg src=\"https://www.wangbase.com/blogimg/asset/201909/bg2019091109.jpg\" alt=\"\" data-href=\"\" style=\"\"\u003e\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e以后，每次修改后推送源码，GitHub Actions 都会自动运行，将构建产物发布到网页。\u003c/p\u003e\u003ch2 style=\"text-align: left;\"\u003e五、参考链接\u003c/h2\u003e\u003cul style=\"text-align: left;\"\u003e\u003cli style=\"text-align: left;\"\u003e\u003ca href=\"https://help.github.com/en/categories/automating-your-workflow-with-github-actions\" target=\"_blank\" style=\"text-align: left;\"\u003eGitHub Pages 官方文档\u003c/a\u003e\u003c/li\u003e\u003cli style=\"text-align: left;\"\u003e\u003ca href=\"https://lukeboyle.com/blog-posts/2019/08/github-actions-for-web-apps/\" target=\"_blank\" style=\"text-align: left;\"\u003eGithub Actions for web apps\u003c/a\u003e, Luke Boyle\u003c/li\u003e\u003cli style=\"text-align: left;\"\u003e\u003ca href=\"https://medium.com/@adam.zolyak/my-first-week-with-github-actions-5d92de4c4851\" target=\"_blank\" style=\"text-align: left;\"\u003eMy First Week With GitHub Actions\u003c/a\u003e, Adam Zolyak\u003c/li\u003e\u003c/ul\u003e\u003cp style=\"text-align: left;\"\u003e（完）\u003c/p\u003e\u003cp style=\"text-align: left;\"\u003e\u003cbr\u003e\u003c/p\u003e","art_author":"yellow star","art_createtime":"2022-11-22T03:41:39.000Z","art_tags":4}},"__N_SSG":true},"page":"/artcontent/[aid]","query":{"aid":"96"},"buildId":"kRrtnNUirzJtMh_xDWC5r","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>