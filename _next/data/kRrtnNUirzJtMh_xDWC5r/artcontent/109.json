{"pageProps":{"datas":{"id":109,"art_title":"react项目前端跨域请求解决方案","art_content":"<p><span style=\"color: rgb(51, 51, 51); background-color: rgb(255, 255, 255); font-size: 16px;\">通过middleware中间件的方式设置proxy</span></p><p><span style=\"color: rgb(51, 51, 51); background-color: rgb(255, 255, 255); font-size: 16px;\">安装插件</span></p><pre><code >yarn add http-proxy-middleware --save\r\n或\r\nnpm install http-proxy-middleware --save</code></pre><p><span style=\"color: rgb(51, 51, 51); background-color: rgb(255, 255, 255); font-size: 16px;\">安装middleware插件后，在src目录中新建setupProxy.js文件，在文件中放入如下代码：</span></p><pre><code class=\"language-javascript\">const { createProxyMiddleware } = require('http-proxy-middleware')\r\n\r\n// 通常使用这种方式就够了，如果报错，可以使用下面的方法\r\nmodule.exports = function (app) {\r\n    app.use(\r\n        proxy('/api1', {     // 遇见/api1开头的请求，触发改代理配置\r\n            target: 'http://172.16.136.249:8080',       // 请求转发给谁\r\n            secure: false,\r\n            changeOrigin: true,     // 控制服务器收到的请求头中的Host值，默认false，意思为服务端收到的Host值是我们自己本的地址，开启以后，服务端收到的就会他自己的地址\r\n            pathRewrite: {\r\n              \"^/api1\": \"/api\"      // 把所有/api1重写成api\r\n            }\r\n        }),\r\n        proxy('/api2', {\r\n            target: 'http://172.16.136.250:8080',\r\n            secure: false,\r\n            changeOrigin: true,\r\n            pathRewrite: {\r\n              \"^/api2\": \"/api\"\r\n            }\r\n        })\r\n    )\r\n}\n\n\r\n//已采用方法，没有问题\r\nmodule.exports = function (app) {\r\n    app.use(\r\n        createProxyMiddleware('/api', {\r\n            target: 'http://172.16.136.249:8080',\r\n            secure: false,\r\n            changeOrigin: true,\r\n            pathRewrite: {\r\n              \"^/api\": \"/api\"\r\n            }\r\n        })\r\n    )\r\n}</code></pre><blockquote>在<span style=\"color: rgb(51, 51, 51); background-color: rgb(255, 255, 255); font-size: 16px;\">setupProxy.js文件中不能使用</span>require直接引用本地项目文件，可能和打包后路径偏差影响有关</blockquote>","art_author":"yellow star","art_createtime":"2022-12-15T03:24:52.000Z","art_tags":4}},"__N_SSG":true}