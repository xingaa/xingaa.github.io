{"pageProps":{"datas":{"id":68,"art_title":"JavaScript将图片转换成Base64字符串的几种方法","art_content":"<h2>FileReader 方法</h2><p>Load the image as blob via <a href=\"https://developer.mozilla.org/de/docs/Web/API/XMLHttpRequest\" target=\"\"><span style=\"color: rgb(0, 56, 132);\">XMLHttpRequest</span></a> and use the <a href=\"https://developer.mozilla.org/de/docs/Web/API/FileReader\" target=\"\"><span style=\"color: rgb(0, 56, 132);\">FileReader API</span></a> (<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/FileReader/readAsDataURL\" target=\"\"><span style=\"color: rgb(0, 56, 132);\">readAsDataURL()</span></a>) to convert it to a <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs\" target=\"\"><span style=\"color: rgb(0, 56, 132);\">dataURL</span></a>:</p><p>通过 XMLHttpRequest 以blob格式请求图像，图像数据返回成功之后， 使用 <a href=\"https://developer.mozilla.org/de/docs/Web/API/FileReader\" target=\"\"><span style=\"color: rgb(0, 56, 132);\">FileReader API</span></a> (<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/FileReader/readAsDataURL\" target=\"\"><span style=\"color: rgb(0, 56, 132);\">readAsDataURL()</span></a>) 将其转换为 dataURL：</p><pre><code class=\"language-javascript\">function toDataURL(url, callback) {\n  var xhr = new XMLHttpRequest();\n  xhr.onload = function() {\n    var reader = new FileReader();\n    reader.onloadend = function() {\n      callback(reader.result);\n    }\n    reader.readAsDataURL(xhr.response);\n  };\n  xhr.open('GET', url);\n  xhr.responseType = 'blob';\n  xhr.send();\n}\n\ntoDataURL('https://www.gravatar.com/avatar/d50c83cc0c6523b4d3f6085295c953e0', function(dataUrl) {\n  console.log('RESULT:', dataUrl)\n})\n</code></pre><p>以下代码发送请求部分也可以使用 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch\" target=\"\"><span style=\"color: rgb(0, 56, 132);\">fetch API</span></a> 接口实现：</p><pre><code class=\"language-javascript\">const toDataURL = url =&gt; fetch(url)\n  .then(response =&gt; response.blob())\n  .then(blob =&gt; new Promise((resolve, reject) =&gt; {\n    const reader = new FileReader()\n    reader.onloadend = () =&gt; resolve(reader.result)\n    reader.onerror = reject\n    reader.readAsDataURL(blob)\n  }))\n\n\ntoDataURL('https://www.gravatar.com/avatar/d50c83cc0c6523b4d3f6085295c953e0')\n  .then(dataUrl =&gt; {\n    console.log('RESULT:', dataUrl)\n  })\n</code></pre><p>这种方式的好处是支持的格式比较多，缺点就是 FileReader API 的兼容性差一点，有部分手机浏览器不支持。</p><h2>Canvas 方法</h2><p>构建一个Image对象，用以加载图片数据。然后通过Canvas的drawImage方法将图片绘制到Canvas上，最后通过Canvas的toDataURL方法将图片转换为base64字符串。</p><pre><code class=\"language-javascript\">function toDataURL(src, callback, outputFormat) {\n  var img = new Image();\n  img.crossOrigin = 'Anonymous';\n  img.onload = function() {\n    var canvas = document.createElement('CANVAS');\n    var ctx = canvas.getContext('2d');\n    var dataURL;\n    canvas.height = this.naturalHeight;\n    canvas.width = this.naturalWidth;\n    ctx.drawImage(this, 0, 0);\n    dataURL = canvas.toDataURL(outputFormat);\n    callback(dataURL);\n  };\n  img.src = src;\n  if (img.complete || img.complete === undefined) {\n    img.src = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==\";\n    img.src = src;\n  }\n}\n\ntoDataURL(\n  'https://www.gravatar.com/avatar/d50c83cc0c6523b4d3f6085295c953e0',\n  function(dataUrl) {\n    console.log('RESULT:', dataUrl)\n  }\n)\n</code></pre><p>这种方式的好处是兼容性好，缺点是只支持图片格式。</p><h2>本地图片转换</h2><p>如果是本地图片，可以使用 <a href=\"https://developer.mozilla.org/de/docs/Web/API/FileReader\" target=\"\"><span style=\"color: rgb(0, 56, 132);\">FileReader API</span></a> 的 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/FileReader/readAsDataURL\" target=\"\"><span style=\"color: rgb(0, 56, 132);\">readAsDataURL()</span></a> 方法将其转换为 dataURL。</p><p>当然，需要有一个文件上传按钮。</p><pre><code class=\"language-javascript\">function encodeImageFileAsURL(element) {\n  var file = element.files[0];\n  var reader = new FileReader();\n  reader.onloadend = function() {\n    console.log('RESULT', reader.result)\n  }\n  reader.readAsDataURL(file);\n}\n\n&lt;input type=\"file\" onchange=\"encodeImageFileAsURL(this)\" /&gt;</code></pre><p>参考资料</p><ul><li style=\"text-align: left;\">How can I convert an image into Base64 string using JavaScript? - Stack Overflow</li></ul>","art_author":"yellow star","art_createtime":"2022-11-02T02:59:31.000Z","art_tags":null}},"__N_SSG":true}