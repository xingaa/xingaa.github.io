{"pageProps":{"datas":{"id":98,"art_title":"ä½¿ç”¨ Github Actions éƒ¨ç½²react-app åˆ° Github Pages","art_content":"<h2 style=\"text-align: start;\">åŸæ–‡ï¼š <a href=\"https://segmentfault.com/a/1190000041449997\" target=\"_blank\">https://segmentfault.com/a/1190000041449997</a> </h2><h2 style=\"text-align: start;\">å‰è¨€-å­¦ä»¥è‡´ç”¨</h2><p style=\"text-align: start;\">ä¹‹å‰ä¸€ç›´å¿™äºå¼€å‘ï¼Œæ€»æ˜¯é›¶æ•£çš„å»çœ‹ä¸€äº›ä¸œè¥¿ï¼Œæƒ³æƒ³å­¦ä¸œè¥¿äº†ä¹ˆï¼Ÿé¢... å¥½åƒå­¦äº†ï¼Œåˆå¥½åƒæ²¡æœ‰å­¦ï¼Œä¸çŸ¥é“ä½ ä»¬æœ‰æ²¡æœ‰è¿™ç§æ„Ÿè§‰ï¼Œæ‰€ä»¥æ–°å¹´åˆå§‹ï¼Œæ¢ä¸€ç§å­¦ä¹ æ–¹æ³•ï¼Œæœ¬ç€å­¦ä»¥è‡´ç”¨å»å®Œæ•´çš„å­¦ä¸€äº›ä¸œè¥¿ï¼Œæ­£å¥½ä¹‹å‰æƒ³æ¥è§¦CI,CD è¿™é‡Œçš„çŸ¥è¯†ï¼Œæ‰€ä»¥å°±ä»æœ€å¸¸è§çš„githubå¼€å§‹å§ï¼Œæ¯•ç«Ÿå…è´¹åˆå¸¸ç”¨ã€‚</p><h2 style=\"text-align: start;\">åˆå§‹åŒ–é¡¹ç›®</h2><p style=\"text-align: start;\">åˆ›å»ºgithubä»£ç ä»“åº“ï¼Œclone é¡¹ç›®åˆ°æœ¬åœ°ï¼Œè¿›å…¥ç›®å½•åˆå§‹åŒ–é¡¹ç›®</p><pre style=\"text-align: start; line-height: 1.5;\"><code>npx create-react-app</code></pre><p style=\"text-align: start;\">ç„¶åæŒ‰ç…§å‘½ä»¤æç¤ºè¾“å…¥å®Œæˆåˆå§‹åŒ–,æ¨é€é¡¹ç›®åˆ°githubã€‚</p><h2 style=\"text-align: start;\">é…ç½®github actions</h2><p style=\"text-align: start;\">ç›®æ ‡æ˜¯å®ç°æ¨é€ä»£ç åˆ°masteråˆ†æ”¯, è‡ªåŠ¨å¼€å§‹æ„å»ºé¡¹ç›®ï¼Œéƒ¨ç½²åˆ°Gthub Pagesã€‚<br>æŒ‰ç…§<a href=\"https://link.segmentfault.com/?enc=BsHuQ0PzigUZ28kaoAvQ1A%3D%3D.qxiSOELr%2FQtZg8yDLMw5z%2F3N%2Fg7890IdTr0xBDUgph6mtDx00VjRN6ObO29wJLlQ\" target=\"_blank\">æ–‡æ¡£</a>å…ˆè·‘èµ·æ¥ç¬¬ä¸€ä¸ªæµç¨‹ï¼Œè®©è‡ªå·±çœ‹åˆ°æ•ˆæœï¼Œåœ¨å»å­¦ä¹ è¯­æ³•å†…å®¹ï¼Œè¿™æ ·æ›´èƒ½æ¿€å‘å…´è¶£ï¼Œå…å¾—ç›´æ¥çœ‹æ–‡æ¡£çœ‹ç¡ç€äº†...</p><ol style=\"text-align: start;\"><li>åœ¨ç›®å½•å¤–å±‚å¢åŠ  .gihub/workflowsæ–‡ä»¶å¤¹ï¼Œåˆ›å»ºç¬¬ä¸€ä¸ªfirst-demo.ymlæ–‡ä»¶ï¼Œæ‹·è´ç¤ºä¾‹å†…å®¹.</li></ol><pre style=\"text-align: start; line-height: 1.5;\"><code>name: GitHub Actions Demo\non: [push]\njobs:\n  Explore-GitHub-Actions:\n    runs-on: ubuntu-latest\n    steps:\n      - run: echo \"ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event.\"\n      - run: echo \"ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!\"\n      - run: echo \"ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}.\"\n      - name: Check out repository code\n        uses: actions/checkout@v2\n      - run: echo \"ğŸ’¡ The ${{ github.repository }} repository has been cloned to the runner.\"\n      - run: echo \"ğŸ–¥ï¸ The workflow is now ready to test your code on the runner.\"\n      - name: List files in the repository\n        run: |\n          ls ${{ github.workspace }}\n      - run: echo \"ğŸ This job's status is ${{ job.status }}.\"</code></pre><ol style=\"text-align: start;\"><li>æäº¤ä»£ç ï¼Œç‚¹å‡»gihubä»“åº“ä¸Šæ–¹çš„<strong>Actions</strong>æŒ‰é’®ï¼ŒæŸ¥çœ‹æ•ˆæœï¼Œç¬¬ä¸€ä¸ªå·¥ä½œæµç¨‹å°±å®Œæˆäº†ã€‚<br><img src=\"https://segmentfault.com/img/bVcX4QB\" alt=\"image.png\" data-href=\"\" style=\"\"></li></ol><h2 style=\"text-align: start;\">å¼€å§‹ç¼–å†™è‡ªå·±çš„ymlæ–‡ä»¶,å®ç°è‡ªåŠ¨æ„å»º</h2><p style=\"text-align: start;\">å¿«é€Ÿè¿‡ä¸€éæ–‡æ¡£ï¼Œå­¦ä¹ ä¸€ä¸‹è¯­æ³•ï¼Œå®ç°è‡ªå·±æƒ³è¦çš„å·¥ä½œæµç¨‹ã€‚ä»demoå¯ä»¥çœ‹åˆ°ä¸»è¦æœ‰æµç¨‹æœ‰è¿™ä¹ˆå‡ æ­¥</p><ol style=\"text-align: start;\"><li>name å·¥ä½œæµç¨‹çš„åç§°ã€‚ GitHub åœ¨ä»“åº“çš„æ“ä½œé¡µé¢ä¸Šæ˜¾ç¤ºå·¥ä½œæµç¨‹çš„åç§°ã€‚</li><li>on è§¦å‘æµç¨‹çš„äº‹ä»¶ï¼Œå…·ä½“å¯ä»¥è§¦å‘çš„äº‹ä»¶æœ‰<a href=\"https://link.segmentfault.com/?enc=RQOtsmXdu0%2FEXbROT%2FG%2F2Q%3D%3D.7z%2ByjH%2FOcAA%2Fn%2FAOG%2FPEc7sSAqWm8y9eeuk2jE6mKo3Sady7tvQdfp9twn8zABomtUFNy9UaxNnRKqmagziAA9KkvrPW%2FqZd9INMAa1hQb5%2Bbgd048QnZ4pxSaX8iVBA\" target=\"_blank\">è¿™äº›</a>,æˆ‘ä»¬æ‰€è¦å®ç°çš„æ˜¯æäº¤ä»£ç ï¼Œæ‰€ä»¥ç”¨ push.</li><li>jobs è¦æŒ‰é¡ºåºè¿è¡Œä½œä¸š.</li></ol><p style=\"text-align: start;\">ç›®æ ‡æ˜ç¡®åï¼Œå¼€å§‹ç¼–å†™yml</p><pre style=\"text-align: start; line-height: 1.5;\"><code class=\"language-xml\"> # æ˜¾ç¤ºå¾—workflowåç§°\n name: First GitHub Actions Demo\n on: \n   # æ¨é€åˆ°masteråˆ†æ”¯å¼€å§‹æ‰“åŒ…\n   push:\n     branches:\n       - master\n\n jobs:\n   # å¼€å§‹æ‰“åŒ…\n   Build:\n     runs-on: ubuntu-latest\n     steps:\n     - name: checkout code\n       # è¿å‡ºè§¦å‘çš„æµç¨‹çš„ç‰ˆæœ¬ èƒ½è®©ä¸‹é¢çš„å·¥ä½œæµç¨‹è®¿é—®\n       uses: actions/checkout@v2\n       # setup-node å¯ä»¥æä¾›nodeç¯å¢ƒï¼ŒæŒ‡å®šnodeç‰ˆæœ¬ä»¥åŠ npm /yarnç¼“å­˜\n     - name: actions/setup-node@v2\n       uses: actions/setup-node@v2   \n       with:\n         node: 16.14\n     # åˆå§‹ç”¨çš„npm æ‰“åŒ…æ—¶é—´å¤ªé•¿äº†ï¼Œå°±æƒ³ç€ç”¨yarn ç»“æœæ²¡ä»”ç»†çœ‹æ–‡æ¡£ï¼Œyarn ä¸ç”¨å®‰è£… ubuntu ä¸Šé¢æœ‰çš„ \n     # - name: install yarn \n     #  uses: npm install yarn     \n     # - run: yarn install\n     # - run: yarn build\n     # ç®€å†™ä¸º\n     - run: yarn install &amp;&amp; yarn build</code></pre><p style=\"text-align: start;\">å¥½äº†æäº¤ä»£ç çœ‹Actionsï¼ˆè¿™æ˜¯ä¸Šé¢æ²¡æœ‰ä¼˜åŒ–æ—¶çš„æµç¨‹ï¼‰ã€‚<br><img src=\"https://segmentfault.com/img/bVcX4U4\" alt=\"image.png\" data-href=\"\" style=\"\"><br>åˆ°æ­¤å·²ç»å®Œæˆäº†æäº¤ä»£ç è‡ªåŠ¨æ‰“åŒ…çš„è¿‡ç¨‹äº†ï¼Œä½†æ˜¯ä¸€çœ‹æ‰“åŒ…æ—¶é—´å¥½å®¶ä¼™ä¸€åˆ†åŠï¼Œè¿™è¦æ˜¯å®é™…å¼€å‘å¤§é‡ä¾èµ–åŠ å…¥ï¼Œé‚£ä¸å¾—åŠä¸ªå°æ—¶ä¹ˆï¼Ÿæ‰“å¼€æµç¨‹ä¸€çœ‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯åœ¨ä¸‹è½½ä¾èµ–ï¼Œæ‰€ä»¥æ˜¯ä¸æ˜¯å¯ä»¥æ·»åŠ ç¼“å­˜å‘¢ï¼Ÿä¸€æœç´¢æœç„¶æœ‰<a href=\"https://link.segmentfault.com/?enc=pnQPaLLU4xUkEVZs%2FAOMvg%3D%3D.2tU0x25fYK3W5v%2BKIaXbPtcgPRdBA3aCtheR9dRUoYVvVXrZqh4THcigzp8RkBWk\" target=\"_blank\">cache</a>,éº»æºœçš„æŒ‰ç…§æ–‡æ¡£æ·»åŠ è¿›å…¥ï¼Œ<br>ä¸€çœ‹æ—¶é—´46s,å“ˆå“ˆæœç„¶æœ‰æ•ˆã€‚åˆ°æ­¤ymlå†…å®¹ä¸º</p><pre style=\"text-align: start; line-height: 1.5;\"><code>name: First GitHub Actions Demo\non: \n  push:\n    branches:\n      - master\n\njobs:\n  Build:\n    runs-on: ubuntu-latest\n    steps:\n    - name: checkout code\n      uses: actions/checkout@v2\n    - name: actions/setup-node@v2\n      uses: actions/setup-node@v2   \n      with:\n        node: 16.14\n    # é…ç½®ä¾èµ–ç¼“å­˜\n    - name: yarn cache\n      id: yarn-cahce-dir-path\n      run: echo \"::set-output name=dir::$(yarn cache dir)\"\n    - uses: actions/cache@v2\n      id: yarn-cache\n      with: \n        path: ${{ steps.yarn-cahce-dir-path.outputs.dir }}\n        key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}\n        restore-keys: | \n          ${{ runner.os }}-yarn-\n    - run: yarn install &amp;&amp; yarn build</code></pre><h2 style=\"text-align: start;\">éƒ¨ç½²é¡µé¢åˆ°Github Pages</h2><ol style=\"text-align: start;\"><li>é¦–å…ˆéœ€è¦è®¾å®šä¸€ä¸ªåˆ†æ”¯ï¼Œå½“åšç«™ç‚¹çš„æ ¹ç›®å½•ï¼Œå…·ä½“<a href=\"https://link.segmentfault.com/?enc=VmP76VTiM%2BW%2BWDCp%2BCe%2BoQ%3D%3D.jjGmPHjENUgpLSpQUCjLgHZb4H9WteP7M1b8%2BsmlO6wkRYs7iMMi5X5gx4V3jda8WFrsrW7EPYw%2F0ARqadAHDW2cDfEmRicaQHdoj%2FsrssbgNcIGSjNimD2L2tqfO61ovyZJ7VdXGgATlEh37KyxRHVcdBEN3%2FFYiTDin%2B4GKvw%3D\" target=\"_blank\">è®¾ç½®æ–‡æ¡£</a>ï¼Œè®¾ç½®å®Œæˆåä¼šå‘Šè¯‰ä½ ç½‘ç«™è®¿é—®åœ°å€ï¼ˆps: ä¸€å®šè¦æŠŠä»“åº“è®¾ç½®ä¸ºPublic,ä¸ç„¶æ— æ³•è¿›è¡Œè®¾ç½®ï¼‰ã€‚</li></ol><p style=\"text-align: start;\"><img src=\"https://segmentfault.com/img/bVcX41W\" alt=\"image.png\" data-href=\"\" style=\"\"></p><ol style=\"text-align: start;\"><li>æŒ‰ç…§æ–‡æ¡£ç¼–è¾‘.yml,å¢åŠ å‘å¸ƒæµç¨‹</li></ol><pre style=\"text-align: start; line-height: 1.5;\"><code> # ä¸Šé¢çš„æ­¥éª¤æ‹¿è¿‡æ¥\n # æ–°å¢ deploy\n  - name: deploy\n    uses: JamesIves/github-pages-deploy-action@v4.2.3\n    with:\n      branch: gh-pages # éƒ¨ç½²çš„åˆ†æ”¯å æœ‰ä¸€å®šè¦ç‹¬ç«‹ä¸€ä¸ªåˆ†æ”¯ï¼Œç¬¬ä¸€æ¬¡è®¾ç½®ä¸ºmaster å¥½å®¶ä¼™æ„å»ºå®Œæˆåï¼Œç›´æ¥æŠŠæˆ‘çš„é¡¹ç›®æ–‡ä»¶æ¸…é™¤äº†ï¼Œåªå‰©ä¸‹æ‰“åŒ…çš„æ–‡ä»¶äº†ã€‚\n      folder: build   # buildåæ–‡ä»¶ç›®å½•</code></pre><p style=\"text-align: start;\">æ•ˆæœ<br><img src=\"https://segmentfault.com/img/bVcX42T\" alt=\"image.png\" data-href=\"\" style=\"\"><br>åˆ°è¿™é‡ŒåŸºæœ¬çš„ç›®æ ‡å·²ç»å®ç°äº†ï¼Œä½†æ˜¯å½“æˆ‘çœ‹å…¬å¸å†…éƒ¨çš„æµç¨‹æ—¶ï¼Œinstall, build, deployæµç¨‹æ˜¯åˆ†å¼€çš„ï¼Œè¿™æ ·æœ‰åˆ©äºå¢åŠ ä¸€äº›æ ¡éªŒï¼Œlintè§„åˆ™ç­‰æµç¨‹ï¼Œæ‰€ä»¥æˆ‘åœ¨æ€è€ƒæ€ä¹ˆæ‹†åˆ†æµç¨‹å‘¢ï¼Œç¬¬ä¸€æ¬¡æˆ‘ç®€å•çš„æ‹†åˆ†</p><pre style=\"text-align: start; line-height: 1.5;\"><code>name: First GitHub Actions Demo\non: \n  push:\n    branches:\n      - master\n      - dev\n\njobs:\n  Build:\n    runs-on: ubuntu-latest\n    steps:\n      uses: actions/checkout@v2\n      uses: actions/setup-node@v2   \n      with:\n        node: 16.14\n    - name: yarn cache\n      id: yarn-cahce-dir-path\n      run: echo \"::set-output name=dir::$(yarn cache dir)\"\n    - uses: actions/cache@v2\n      id: yarn-cache\n      with: \n        path: ${{ steps.yarn-cahce-dir-path.outputs.dir }}\n        key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}\n        restore-keys: | \n          ${{ runner.os }}-yarn-   \n    - run: yarn install\n    - run: yarn build\n  Deploy:\n    - name: depploy\n      uses: JamesIves/github-pages-deploy-action@v4.2.3\n      width:\n        branch: gh-pages\n        folder: build\n        clean: true\n        clean-exclude: |\n          special-file.txt\n          some/*.txt\n        ssh-key: ${{ secrets.PAGE_ACCESS_TOKEN }}    </code></pre><p style=\"text-align: start;\">æˆ‘æƒ³ç€è¿™æ ·åº”è¯¥å°±å¯ä»¥äº†ï¼Œä¸€æäº¤ä»£ç ç›´æ¥GG,ç¬¬ä¸€æ˜¯æ²¡æœ‰Deployæ²¡æœ‰ç­‰å¾…buildå®Œæˆï¼Œç¬¬äºŒæ˜¯ä¸¤ä¸ªjobä¹‹é—´çš„æ–‡ä»¶ä¸èƒ½å¤Ÿç›´æ¥ç”¨ï¼Œåˆç¿»äº†ä¸‹æ–‡æ¡£æ‰å‘ç°å®˜æ–¹ç»™äº†è¿™ä¸¤ä¸ª actions/upload-artifact@v2 actions/download-artifact@v2 å¯ä»¥åœ¨ä¸åŒjobä¹‹é—´å…¬ç”¨æ–‡ä»¶ï¼Œæ‰€ä»¥åˆæ”¹äº†æ”¹,buildé˜¶æ®µä¸Šä¼ æ‰“åŒ…å¥½çš„æ–‡ä»¶ï¼Œdeployé˜¶æ®µä¸‹è½½æ‰“åŒ…å¥½çš„æ–‡ä»¶è¿›è¡Œéƒ¨ç½²ï¼ˆæ³¨æ„deployä¹Ÿè¦ä½¿ç”¨checkout@v2ï¼‰ã€‚<br>æœ€ç»ˆç»“æœ</p><pre style=\"text-align: start; line-height: 1.5;\"><code>name: First GitHub Actions Demo\non: \n  push:\n    branches:\n      - master\n      - dev\n\njobs:\n  Build:\n    runs-on: ubuntu-latest\n    steps:\n    # æ­¥éª¤åç§°\n    - name: checkout code\n      uses: actions/checkout@v2\n    - name: actions/setup-node@v2\n      uses: actions/setup-node@v2   \n      with:\n        node-version: '16.14'\n        cache: 'yarn'\n        cache-dependency-path: '**/yarn.lock'\n    # ç¼“å­˜ æœ‰éœ€è¦å¯ä»¥å¼€å¯ åŒæ—¶ setu node ä¹Ÿå¯ä»¥è¿›è¡Œç¼“å­˜\n    # - name: yarn cache\n    #   id: yarn-cahce-dir-path\n    #   run: echo \"::set-output name=dir::$(yarn cache dir)\"\n    # - uses: actions/cache@v2\n    #   id: yarn-cache\n    #   with: \n    #     path: ${{ steps.yarn-cahce-dir-path.outputs.dir }}\n    #     key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}\n    #     restore-keys: | \n    #       ${{ runner.os }}-yarn-    \n    - run: yarn install &amp;&amp; yarn build  \n    # ä¸Šä¼ æ‰“åŒ…å¥½çš„æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸‹ä¸€æ­¥å¯ä»¥ä½¿ç”¨\n    - name: upload files \n      uses: actions/upload-artifact@v2\n      with: \n        name: build-pages\n        path: build\n        retention-days: 1\n  Deploy: \n    needs: Build # ç¡®ä¿build é˜¶æ®µå®Œæˆ\n    runs-on: ubuntu-latest\n    steps:\n      - name: checkout code\n        uses: actions/checkout@v2\n      - name: download build files\n        uses: actions/download-artifact@v2\n        with:\n          name: build-pages\n          path: build\n      - name: deploy\n        uses: JamesIves/github-pages-deploy-action@v4.2.3\n        with:\n          branch: gh-pages\n          folder: build \n          token: \"${{ secrets.DEPLOY_TOKEN }}\"  </code></pre><p style=\"text-align: start;\">æäº¤ä»£ç ï¼ŒæŸ¥çœ‹è¿è¡Œç»“æœï¼Œå®Œæˆæ‹†åˆ†ã€‚<br><img src=\"https://segmentfault.com/img/bVcX49V\" alt=\"image.png\" data-href=\"\" style=\"\"><br>åˆ°è¿™é‡Œå¯ä»¥æ„‰å¿«çš„è®¿é—®ä½ çš„ç½‘ç«™äº†ã€‚</p><h2 style=\"text-align: start;\">ç»“å°¾</h2><p style=\"text-align: start;\">å†™ä½œæ€è·¯æ˜¯æŒ‰ç…§å½“æ—¶å®Œæˆçš„æ€è·¯ä¸€æ­¥ä¸€æ­¥çš„å»å®Œæˆè¿™ä¸ªæµç¨‹æ¥çš„ï¼Œæ‰€ä»¥æœ‰äº›åŠŸèƒ½å¯èƒ½è¿˜æ²¡æƒ³åˆ°ï¼ŒåŒæ—¶å¦‚æœæµç¨‹æœ‰ä»€ä¹ˆå¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ï¼Œæ¬¢è¿å„ä½å¤§ä½¬æŒ‡æ•™ã€‚å½“ç„¶ï¼Œå®Œæ•´çš„æµç¨‹è¿˜æ¬ ç¼ºå¾ˆå¤šï¼Œç›®å‰åªæ˜¯å…ˆå®Œæˆç®€å•çš„æ‰“åŒ…æ„å»ºæµç¨‹ï¼Œæ¥ä¸‹æ¥è¿˜éœ€è¦å»å­¦ä¹ gitlab çš„CIã€CD,å®Œæˆåä¼šåœ¨æ°´ä¸€ç¯‡æ–‡ç« ã€‚åœ¨ä¹‹åæ‰ä¼šå»çœ‹ä¸€äº›éƒ¨ç½²é¡¹ç›®ç›¸å…³çš„å†…å®¹ã€‚æ¯”å¦‚Docker,Nginxç­‰ï¼Œå¸Œæœ›èƒ½åœ¨ç©ºé—²ä¹‹ä½™å­¦ä¼šæ•´ä¸ªæµç¨‹ã€‚åŠ æ²¹ï¼</p><p><br></p>","art_author":"yellow star","art_createtime":"2022-11-23T08:37:21.000Z","art_tags":4}},"__N_SSG":true}